---
pagination_prev:
pagination_next:
---

# k3s

These steps build a kubernetes cluster using k3s.  
k3s is an extremely light-weight but capable kubernetes distribution.

### Install Kubernetes

Start by installing the base k3s package.

```bash
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--no-deploy traefik" sh -
```

- `curl` downloads the k3s installer.
- `|` is the pipe command chaining multiple commands together.
- `INSTALL_K3S_EXEC...` sets an environment variable instructing the install to skip k3s' default ingress controller traefik.
- `sh -` runs the result of the previous step in a shell (in this case, the k3s install).

### Copy config file to default spot & install kubectl

Create a folder and move the kubernetes config file to a default location to help further standardize this kubernetes install.

<details>
  <summary>What is the kubernetes config file?</summary>
  <ul>
    <li>
      Kubernetes distributions create a config file that describe the cluster
      and how to access it.
    </li>
    <li>
      k3s doesn't store the config file where kubectl normally looks for it.
      These next few steps move the file to the default spot where kubectl will
      look.
    </li>
  </ul>
</details>

```bash
mkdir -m700 ~/.kube
```

- `mkdir` is the linux **make directory** command.
- `-m700` limits the permissions to just our user (preventing security warnings later)
- `~/.kube` is the standard folder location for the config file.

Export the config file to the folder you created.

```bash
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
```

Ensure you are the file's owner (prevents security warnings/issues later).

```bash
sudo chown -R $USER ~/.kube
```

### Install kubectl

k3s comes with a slightly modified kubectl command. There's nothing wrong with it-
but to make sure kubernetes works in a standard way across all tutorials, we'll install and use the official kubectl.

Download kubectl.

```bash
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
```

:::info

The weird bonus curl command in the middle simply gets the most current version number for downloading in the main curl command.

:::

Install.

```bash
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
```

### :checkered_flag: Checkpoint

To check that everything works, run the following.

```bash
kubectl get nodes
```

If you see a response indicating a `READY` status, congratulations :tada:! You have kubernetes.

![node_ready](/img/node_ready.png)

### Final config for k3s

We skipped the k3s ingress controller during install. We'll install nginx with the command below.

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.2/deploy/static/provider/cloud/deploy.yaml
```

When the installation is done, you'll have 2 pods in a _completed_ state. You can clean up your cluster with:

```bash
kubectl delete pod --field-selector=status.phase==Succeeded -A
```

> These pods were used to build the nginx controller. Like scaffolding used to build a house, it's safe to remove once the house is done.

## Next steps

With kubernetes running, deploying an application to test is the next step.
